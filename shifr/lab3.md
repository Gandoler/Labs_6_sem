# Лабораторная работа #3: Стеганография

## Введение
Стеганография — это наука о скрытой передаче информации, при которой сам факт передачи остается незаметным. В отличие от криптографии, которая шифрует содержимое сообщения, стеганография маскирует само существование сообщения. Например, секретное сообщение может быть спрятано в изображении, тексте или аудиофайле.

## Метод LSB (Least Significant Bit)
Метод LSB заключается в замене последних битов пикселей изображения на биты скрываемого сообщения. Это позволяет сохранить исходный вид изображения, так как изменения минимальны и незаметны для человеческого глаза.

### Пример использования метода LSB
Предположим, у нас есть 8-битное изображение в градациях серого и мы хотим скрыть 1 байт данных (например, `01101011`). Если мы используем два младших бита каждого пикселя, нам потребуется 4 пикселя:
- Пиксель 1: `00000001` (изменение цвета на 1/255)
- Пиксель 2: `00000010` (изменение цвета на 2/255)
- Пиксель 3: `00000010` (изменение цвета на 2/255)
- Пиксель 4: `00000011` (изменение цвета на 3/255)

Эти изменения настолько малы, что их практически невозможно заметить.

## Формат файла BMP
Файл BMP состоит из нескольких частей:
- **Заголовок файла**: содержит информацию о размере файла и смещении растра.
- **Заголовок BITMAP**: содержит информацию об изображении, такие как ширина, высота и количество бит на пиксель.
- **Палитра**: используется для хранения цветов в изображении.
- **Растр**: содержит фактические данные пикселей.

## Реализация метода LSB в коде

### Основные компоненты программы
Программа состоит из двух основных методов:
1. **HideMessage**: Скрывает сообщение в изображении.
2. **ExtractMessage**: Извлекает скрытое сообщение из изображения.

### Как работает метод HideMessage
1. **Чтение изображения**: Программа считывает байты изображения в массив `bmpbytes`.
2. **Подготовка сообщения**: Сообщение преобразуется в массив байтов `msgBytes`, и к нему добавляется специальный маркер `0xFF`, который будет использоваться для обозначения конца сообщения.
3. **Проверка размера**: Программа проверяет, достаточно ли места в изображении для скрытия сообщения. Если нет, выводится сообщение об ошибке.
4. **Сокрытие сообщения**: Каждый байт сообщения разбивается на 4 части по 2 бита, которые затем записываются в младшие биты пикселей изображения. Это делается с помощью побитовых операций:
   - `bmpbytes[pixelOffset] &= 0xFC;` — обнуляет два младших бита.
   - `bmpbytes[pixelOffset] |= (byte)((Hidemsg[i] >> 6) & 0x03);` — записывает два бита сообщения в младшие биты пикселя.
5. **Сохранение изображения**: Изображение с скрытым сообщением сохраняется в новый файл.

### Как работает метод ExtractMessage
1. **Чтение изображения**: Программа считывает байты изображения в массив `bmpBytes`.
2. **Извлечение сообщения**: Программа проходит по пикселям изображения, извлекая два младших бита из каждого пикселя и объединяя их в байты сообщения.
3. **Остановка по маркеру**: Если встречается байт `0xFF`, извлечение сообщения прекращается.
4. **Вывод сообщения**: Извлеченное сообщение выводится на экран.

### Пример работы с байтами
Рассмотрим пример, как байт сообщения `01101011` (107 в десятичной системе) скрывается в четырех пикселях:
1. Байт разбивается на четыре части по два бита: `01`, `10`, `10`, `11`.
2. Каждая часть записывается в младшие биты соответствующего пикселя:
   - Пиксель 1: `00000001` (1)
   - Пиксель 2: `00000010` (2)
   - Пиксель 3: `00000010` (2)
   - Пиксель 4: `00000011` (3)

При извлечении сообщения эти биты снова объединяются в исходный байт `01101011`.

## Заключение
Метод LSB является простым и эффективным способом скрытия информации в изображениях. Он позволяет сохранить визуальное качество изображения, при этом обеспечивая возможность передачи скрытых данных. В данной лабораторной работе была реализована программа, которая успешно скрывает и извлекает сообщения в BMP-файлах с использованием метода LSB.
