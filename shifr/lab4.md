# Лабораторная работа №4: Шифрование алгоритмом Blowfish

## Введение
В данной лабораторной работе мы рассмотрим алгоритм блочного шифра Blowfish, разработанный Брюсом Шнайером в 1993 году. Blowfish отличается высокой криптостойкостью и скоростью шифрования благодаря использованию переменной длины ключа (до 448 бит) и генерации таблиц замены.

### Основные характеристики Blowfish:
- **Блочный шифр**: Работает с блоками данных фиксированной длины (64 бита).
- **Переменная длина ключа**: Длина ключа может варьироваться от 32 до 448 бит.
- **Высокая скорость**: Использует предварительно вычисленные таблицы для ускорения процесса шифрования/дешифрования.

## Структура алгоритма Blowfish
Алгоритм Blowfish состоит из двух основных этапов:
1. **Расширение ключа**
2. **Шифрование/дешифрование данных**

### Этап расширения ключа
На этом этапе исходный ключ преобразуется в матрицу раундовых ключей (P) и матрицу подстановки (S-box). Общий объем этих матриц составляет 4168 байт.

#### Процесс расширения ключа:
1. **Выбор "искреннего числа"**: Используется число PI для заполнения матрицы раундовых ключей и матрицы подстановки. Это делается для обеспечения прозрачности и безопасности алгоритма.
2. **XOR исходного ключа с раундовыми ключами**: Каждый элемент матрицы P складывается по модулю 2 (XOR) с соответствующими частями исходного ключа.
3. **Шифрование матриц**: Используя текущие значения матриц P и S, производится шифрование 64-битной последовательности нулей. Результат записывается в матрицу P, и процесс повторяется до полного обновления всех элементов P и S.

### Функция итерации (F)
Функция F является "черным ящиком", который преобразует 32-битный вход в 32-битный выход. Она использует матрицы подстановки S1-S4 для нелинейного преобразования данных.

#### Реализация функции F на C++:
```cpp
unsigned long F(blowfish_ctx *ctx, unsigned long x) {
    return ((ctx->sbox[0][(x >> 24) & 0xFF] + ctx->sbox[1][(x >> 16) & 0xFF]) ^
            ctx->sbox[2][(x >> 8) & 0xFF]) + ctx->sbox[3][(x) & 0xFF];
}
```

### Шифрование/дешифрование данных
Процесс шифрования и дешифрования данных происходит через сеть Фейстеля, состоящую из 16 раундов. На каждом раунде используется функция F и раундовые ключи P.

#### Принцип работы сети Фейстеля:
1. Исходные данные разбиваются на два равных подблока L0 и R0.
2. Подблок L0 видоизменяется функцией F и складывается по модулю 2 с подблоком R0.
3. Результат становится новым подблоком L1, а старый L0 переходит в R1.
4. Процесс повторяется 16 раз с изменением раундовых ключей.

## Задание
Необходимо написать программу на любом языке программирования, реализующую шифрование и дешифрование алгоритмом Blowfish. Проверить правильность работы программы и найти возможные ошибки в представлении сети Фейстеля.

### План выполнения задания:
1. **Изучение теории**: Понять принцип работы алгоритма Blowfish, включая расширение ключа и сеть Фейстеля.
2. **Разработка программы**:
   - Реализовать структуру данных для хранения матриц P и S.
   - Написать функцию для расширения ключа.
   - Реализовать функцию F.
   - Создать функции для шифрования и дешифрования данных.
3. **Тестирование**: Проверить работу программы на различных тестовых данных, убедиться в корректности шифрования и дешифрования.
4. **Анализ ошибок**: Проверить правильность представления сети Фейстеля и исправить возможные ошибки.

## Заключение
В результате выполнения данной лабораторной работы студент должен получить практические навыки в реализации и применении алгоритма блочного шифра Blowfish. Это позволит глубже понять принципы криптографии и повысить уровень знаний в области защиты информации.
