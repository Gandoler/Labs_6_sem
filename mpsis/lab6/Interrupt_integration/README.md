| Адрес | Машинный код | Ассемблерная инструкция       | Описание поведения                                                               | время                 | доп пояснения |
|-------|--------------|-------------------------------|----------------------------------------------------------------------------------|-----------------------| -----------   |
| 00    | `00004137`   | `lui x2, 0x4`                 | Инициализация SP: Загружает `0x4000` в верхние 20 бит `x2` (`SP = 0x4000`)       |1: 10-50 ns            |               |
| 04    | `FF010113`   | `addi x2, x2, -16`            | Корректировка SP: `SP = 0x4000 - 16 = 0x3FF0` (установка стека)                  |2: 50-70 ns            |               |
| 08    | `00000193`   | `addi x3, x0, 0`              | Инициализация `x3 = 0` (указатель на глобальные данные)                          |3: 70-90 ns            |               |
| 0C    | `04400293`   | `lui x5, 0x44000`             | Начало загрузки адреса `trap_handler` (псевдоинструкция `la x5`)                 |4: 90-110 ns           |               |
| 10    | `00028293`   | `addi x5, x5, 0`              | Завершение: `x5 = 0x44000` (адрес обработчика)                                   |5: 110-130 ns          |               | 
| 14    | `30529073`   | `csrw mtvec, x5`              | Установка вектора прерываний: `mtvec = 0x44000`                                  |6: 130-150 ns          |               |
| 18    | `000022B7`   | `lui x5, 0x2`                 | Подготовка стека прерываний: `x5 = 0x2000`                                       |7: 150-170 ns          |               |
| 1C    | `FFC28293`   | `addi x5, x5, -4`             | Корректировка: `x5 = 0x1FFC` (адрес стека прерываний)                            |8: 170-190 ns          |               |
| 20    | `34029073`   | `csrw mscratch, x5`           | Установка стека прерываний: `mscratch = 0x1FFC`                                  |9: 190-210 ns          |можно заметить на wd             | 
| 24    | `000102B7`   | `lui x5, 0x10`                | Подготовка маски прерываний: `x5 = 0x10000`                                      |10: 210-230 ns         |               |
| 28    | `30429073`   | `csrw mie, x5`                | Активация прерываний: `mie = 0x10000` (внешние прерывания)                       |11: 230-250 ns         | видно как на след такте mie поменялся и 
| 2C    | `00100293`   | `addi x5, x0, 1`              | Инициализация переменной: `x5 = 1`                                               |12: 250-270 ns         |               |
| 30    | `0051A023`   | `sw x5, 0(x3)`                | Сохранение в память: `mem[0] = 1`                                                |13: 270-310 ns         |               |
| 34    | `00000313`   | `addi x6, x0, 0`              | Обнуление `x6`                                                                   |14: 310-330 ns         |               |
| 38    | `00000393`   | `addi x7, x0, 0`              | Обнуление `x7`                                                                   |15: 330-350 ns         |               |
| 3C    | `00000073`   | `ecall`                       | Генерация исключения (`illegal instruction`)|16: 350-370 ns| видно что pc стал равен = 0x44000 и адрес иструкции перепрыгнул на обработчика прервыний
| 40    | `00000063`   | `beq x0, x0, main`            | Бесконечный цикл (`while(1)`)                                                    |36: 870---                       |               |      
| **Обработчик прерываний**                                                                                                               |
| 44    | `340292F3`   | `csrrw x5, mscratch, x5`      | Сохранение в`x5` `mscratch` (обмен значениями)                                   |17: 370-390            |можно заметить на wd            | 
| 48    | `FF028293`   | `addi x5, x5, -16`            | Выделение 16 байт на стеке (выравнивание)                                        |18: 390-410            |1FEC получается                 |
| 4C    | `0062A023`   | `sw x6, 0(x5)`                | Сохранение `x6`                                                                  |19: 410-450            | просто сохраняются нули |
| 50    | `0072A223`   | `sw x7, 4(x5)`                | Сохранение `x7`                                                                  |20: 450-490            |просто сохраняются нули |
| 54    | `34202373`   | `csrr x6, mcause`             | Чтение причины прерывания/исключения (`mcause`)                                  |21: 490-510            | равно 2 - нелегал в инструкции|
| 58    | `800003B7`   | `lui x7, 0x80000`             | Подготовка маски для проверки типа события                                       |22: 510-530            |                |
| 5C    | `01038393`   | `addi x7, x7, 16`             | `x7 = 0x80000010` (флаг прерывания)                                              |23: 530-540            |                |
| 60    | `00731A63`   | `bne x6, x7, exc_handler`     | Если не прерывание → переход к обработчику исключений |24: 550-570            | но у нас исключение из-за нелегальной инструкции поэтому переход на 00200393|
| 64    | `0001A383`   | `lw x7, 0(x3)`                | Чтение глобальной переменной из памяти                                           | тут из-за прерывание идем второй круг
| 68    | `00338393`   | `addi x7, x7, 3`              | Инкремент значения на `3`                                                        |
| 6C    | `0071A023`   | `sw x7, 0(x3)`                | Сохранение обновленного значения                                                 |
| 70    | `0200006F`   | `jal x0, done`                | Переход к восстановлению контекста                                               |
| **Обработчик исключений**                                                                                     |
| 74    | `00200393`   | `addi x7, x0, 2`              | Код исключения: `mcause=2` (`illegal instruction`)                               |25: 570-590            |                 |
| 78    | `00731C63`   | `bne x6, x7, done`            | Если не `illegal instruction` → пропуск обработки                                |26: 590-610            | у нас нелегал а значит не пропускем            |
| 7C    | `34102373`   | `csrr x6, mepc`               | Чтение адреса исключительной инструкции (`mepc`)                                 |27: 610-630            | видно что в wd адресс 3c той инструкции|
| 80    | `00032383`   | `lw x7, 0(x6)`                | *Попытка чтения инструкции (не поддерживается)*                                  |28: 630-670            | минус - ничего не получаем |
| 84    | `00430313`   | `addi x6, x6, 4`              | Пропуск проблемной инструкции: `mepc += 4`                                       |29: 670-690            | подготовка для мепке адресс некст функции|
| 88    | `34131073`   | `csrw mepc, x6`               | Обновление `mepc` для возврата                                                   |30: 690-710 | загрузка в мепке адресса возрата "сейчас там старый" 
| 8C    | `0040006F`   | `jal x0, done`                | Переход к восстановлению контекста                                               |31: 710-730            | 
| **Восстановление контекста**                                                                                  |
| 90    | `0002A303`   | `lw x6, 0(x5)`                | Восстановление `x6` из стека                                                     |32: 730-770            | достаем 6 регистр нолик|
| 94    | `0042A383`   | `lw x7, 4(x5)`                | Восстановление `x7` из стека                                                     |32: 770-810            | достаем 7 регистр нолик|
| 98    | `01028293`   | `addi x5, x5, 16`             | Освобождение стека (`16` байт)        |33: 810-830| получаем 1ffc обратно в mscratch (чтобы стек прерываний остался корректным для следующего прерывания|
| 9C    | `340292F3`   | `csrrw x5, mscratch, x5`      | Восстановление оригинального  `mscratch`                                         |34: 830-850            |
| A0    | `30200073`   | `mret`                        | Возврат из обработчика (`PC = mepc`)                                             |35: 850-870            | прыжок



## доп инфа 

Таким образом: в случае если произошло исключение (в связи с нелегальной инструкцией), значение mcause должно быть 0x00000002. Если произошло прерывание, значение mcause должно быть 0x80000010

