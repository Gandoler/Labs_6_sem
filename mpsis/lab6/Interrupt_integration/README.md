| Адрес | Машинный код | Ассемблерная инструкция       | Описание поведения                                                               | время            | доп пояснения |
|-------|--------------|-------------------------------|----------------------------------------------------------------------------------|----------------- | -----------   |
| 00    | `00004137`   | `lui x2, 0x4`                 | Инициализация SP: Загружает `0x4000` в верхние 20 бит `x2` (`SP = 0x4000`)       |  10-50 ns        |               |
| 04    | `FF010113`   | `addi x2, x2, -16`            | Корректировка SP: `SP = 0x4000 - 16 = 0x3FF0` (установка стека)                  |  50-70 ns        |               |
| 08    | `00000193`   | `addi x3, x0, 0`              | Инициализация `x3 = 0` (указатель на глобальные данные)                          |  70-90 ns        |               |
| 0C    | `04400293`   | `lui x5, 0x44000`             | Начало загрузки адреса `trap_handler` (псевдоинструкция `la x5`)                 |  90-130 ns       |               |
| 10    | `00028293`   | `addi x5, x5, 0`              | Завершение: `x5 = 0x44000` (адрес обработчика)                                   |  90-130 ns       |               | 
| 14    | `30529073`   | `csrw mtvec, x5`              | Установка вектора прерываний: `mtvec = 0x44000`                                  |  130-150 ns      |               |
| 18    | `000022B7`   | `lui x5, 0x2`                 | Подготовка стека прерываний: `x5 = 0x2000`                                       |  150-170 ns      |               |
| 1C    | `FFC28293`   | `addi x5, x5, -4`             | Корректировка: `x5 = 0x1FFC` (адрес стека прерываний)                            |  170-190 ns      |               |
| 20    | `34029073`   | `csrw mscratch, x5`           | Установка стека прерываний: `mscratch = 0x1FFC`                                  |  190-210 ns      |можно заметить на wd             | 
| 24    | `000102B7`   | `lui x5, 0x10`                | Подготовка маски прерываний: `x5 = 0x10000`                                      |  210-230 ns      |               |
| 28    | `30429073`   | `csrw mie, x5`                | Активация прерываний: `mie = 0x10000` (внешние прерывания)                       |  230-250 ns| видно как на след такте mie поменялся и 
| 2C    | `00100293`   | `addi x5, x0, 1`              | Инициализация переменной: `x5 = 1`                                               |
| 30    | `0051A023`   | `sw x5, 0(x3)`                | Сохранение в память: `mem[0] = 1`                                                |
| 34    | `00000313`   | `addi x6, x0, 0`              | Обнуление `x6`                                                                   |
| 38    | `00000393`   | `addi x7, x0, 0`              | Обнуление `x7`                                                                   |
| 3C    | `00000073`   | `ecall`                       | Генерация исключения (`illegal instruction`)                                     |
| 40    | `00000063`   | `beq x0, x0, main`            | Бесконечный цикл (`while(1)`)                                                    |
| **Обработчик прерываний**                                                                                                               |
| 44    | `340292F3`   | `csrrw x5, mscratch, x5`      | Сохранение `x5` в `mscratch` (обмен значениями)                                  |
| 48    | `FF028293`   | `addi x5, x5, -16`            | Выделение 16 байт на стеке (выравнивание)                                        |
| 4C    | `0062A023`   | `sw x6, 0(x5)`                | Сохранение `x6` на стек                                                          |
| 50    | `0072A223`   | `sw x7, 4(x5)`                | Сохранение `x7` на стек                                                          |
| 54    | `34202373`   | `csrr x6, mcause`             | Чтение причины прерывания/исключения (`mcause`)                                  |
| 58    | `800003B7`   | `lui x7, 0x80000`             | Подготовка маски для проверки типа события                                       |
| 5C    | `01038393`   | `addi x7, x7, 16`             | `x7 = 0x80000010` (флаг прерывания)                                             |
| 60    | `00731A63`   | `bne x6, x7, exc_handler`     | Если не прерывание → переход к обработчику исключений                            |
| 64    | `0001A383`   | `lw x7, 0(x3)`                | Чтение глобальной переменной из памяти                                           |
| 68    | `00338393`   | `addi x7, x7, 3`              | Инкремент значения на `3`                                                        |
| 6C    | `0071A023`   | `sw x7, 0(x3)`                | Сохранение обновленного значения                                                 |
| 70    | `0200006F`   | `jal x0, done`                | Переход к восстановлению контекста                                               |
| **Обработчик исключений**                                                                                     |
| 74    | `00200393`   | `addi x7, x0, 2`              | Код исключения: `mcause=2` (`illegal instruction`)                               |
| 78    | `00731C63`   | `bne x6, x7, done`            | Если не `illegal instruction` → пропуск обработки                                |
| 7C    | `34102373`   | `csrr x6, mepc`               | Чтение адреса исключительной инструкции (`mepc`)                                 |
| 80    | `00032383`   | `lw x7, 0(x6)`                | *Попытка чтения инструкции (не поддерживается)*                                  |
| 84    | `00430313`   | `addi x6, x6, 4`              | Пропуск проблемной инструкции: `mepc += 4`                                       |
| 88    | `34131073`   | `csrw mepc, x6`               | Обновление `mepc` для возврата                                                   |
| 8C    | `0040006F`   | `jal x0, done`                | Переход к восстановлению контекста                                               |
| **Восстановление контекста**                                                                                  |
| 90    | `0002A303`   | `lw x6, 0(x5)`                | Восстановление `x6` из стека                                                     |
| 94    | `0042A383`   | `lw x7, 4(x5)`                | Восстановление `x7` из стека                                                     |
| 98    | `01028293`   | `addi x5, x5, 16`             | Освобождение стека (`16` байт)                                                   |
| 9C    | `340292F3`   | `csrrw x5, mscratch, x5`      | Восстановление оригинального `x5` из `mscratch`                                  |
| A0    | `30200073`   | `mret`                        | Возврат из обработчика (`PC = mepc`)                                             |
